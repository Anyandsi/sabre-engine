#include "Renderer.h"
#include <glad/glad.h>
#include <glm/gtc/type_ptr.hpp>

void Renderer::init()
{
    glEnable(GL_DEPTH_TEST);
    glClearColor(0.2f, 0.2f, 0.2f, 1.0f);

    std::vector<float> vertices = {
        -0.5f,
        -0.5f,
        0.5f,
        1,
        0,
        0,
        0,
        0,
        0.5f,
        -0.5f,
        0.5f,
        1,
        0,
        0,
        1,
        0,
        0.5f,
        0.5f,
        0.5f,
        1,
        0,
        0,
        1,
        1,

        0.5f,
        0.5f,
        0.5f,
        1,
        0,
        0,
        1,
        1,
        -0.5f,
        0.5f,
        0.5f,
        1,
        0,
        0,
        0,
        1,
        -0.5f,
        -0.5f,
        0.5f,
        1,
        0,
        0,
        0,
        0,

        0.5f,
        -0.5f,
        -0.5f,
        0,
        1,
        0,
        0,
        0,
        -0.5f,
        -0.5f,
        -0.5f,
        0,
        1,
        0,
        1,
        0,
        -0.5f,
        0.5f,
        -0.5f,
        0,
        1,
        0,
        1,
        1,

        -0.5f,
        0.5f,
        -0.5f,
        0,
        1,
        0,
        1,
        1,
        0.5f,
        0.5f,
        -0.5f,
        0,
        1,
        0,
        0,
        1,
        0.5f,
        -0.5f,
        -0.5f,
        0,
        1,
        0,
        0,
        0,

        -0.5f,
        -0.5f,
        -0.5f,
        0,
        0,
        1,
        0,
        0,
        -0.5f,
        -0.5f,
        0.5f,
        0,
        0,
        1,
        1,
        0,
        -0.5f,
        0.5f,
        0.5f,
        0,
        0,
        1,
        1,
        1,

        -0.5f,
        0.5f,
        0.5f,
        0,
        0,
        1,
        1,
        1,
        -0.5f,
        0.5f,
        -0.5f,
        0,
        0,
        1,
        0,
        1,
        -0.5f,
        -0.5f,
        -0.5f,
        0,
        0,
        1,
        0,
        0,
        0.5f,
        -0.5f,
        0.5f,
        1,
        1,
        0,
        0,
        0,
        0.5f,
        -0.5f,
        -0.5f,
        1,
        1,
        0,
        1,
        0,
        0.5f,
        0.5f,
        -0.5f,
        1,
        1,
        0,
        1,
        1,

        0.5f,
        0.5f,
        -0.5f,
        1,
        1,
        0,
        1,
        1,
        0.5f,
        0.5f,
        0.5f,
        1,
        1,
        0,
        0,
        1,
        0.5f,
        -0.5f,
        0.5f,
        1,
        1,
        0,
        0,
        0,
        -0.5f,
        0.5f,
        0.5f,
        0,
        1,
        1,
        0,
        0,
        0.5f,
        0.5f,
        0.5f,
        0,
        1,
        1,
        1,
        0,
        0.5f,
        0.5f,
        -0.5f,
        0,
        1,
        1,
        1,
        1,

        0.5f,
        0.5f,
        -0.5f,
        0,
        1,
        1,
        1,
        1,
        -0.5f,
        0.5f,
        -0.5f,
        0,
        1,
        1,
        0,
        1,
        -0.5f,
        0.5f,
        0.5f,
        0,
        1,
        1,
        0,
        0,
        -0.5f,
        -0.5f,
        -0.5f,
        1,
        0,
        1,
        0,
        0,
        0.5f,
        -0.5f,
        -0.5f,
        1,
        0,
        1,
        1,
        0,
        0.5f,
        -0.5f,
        0.5f,
        1,
        0,
        1,
        1,
        1,

        0.5f,
        -0.5f,
        0.5f,
        1,
        0,
        1,
        1,
        1,
        -0.5f,
        -0.5f,
        0.5f,
        1,
        0,
        1,
        0,
        1,
        -0.5f,
        -0.5f,
        -0.5f,
        1,
        0,
        1,
        0,
        0,
    };

    mesh = new Mesh(vertices);
    mesh->transform.rotate(-45.0f, glm::vec3(1.0f, 0.0f, 0.0f));
    mesh->transform.rotate(-45.0f, glm::vec3(0.0f, 0.0f, 1.0f));
}

void Renderer::render()
{
    glClear(GL_COLOR_BUFFER_BIT);
    glUseProgram(mesh->getProgram());

    glm::mat4 view = glm::mat4(1.0f);
    view = glm::translate(view, glm::vec3(0.0f, 0.0f, -3.0f));

    glm::mat4 projection;
    projection = glm::perspective(glm::radians(45.0f), 800.0f / 600.0f, 0.1f,
                                  100.0f);

    glUniformMatrix4fv(
        glGetUniformLocation(mesh->getProgram(), "view"),
        1, GL_FALSE, glm::value_ptr(view));

    glUniformMatrix4fv(
        glGetUniformLocation(mesh->getProgram(), "projection"),
        1, GL_FALSE, glm::value_ptr(projection));

    mesh->draw();
}